<div class="min-h-screen bg-gray-50 py-8 px-4">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-7">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">{{ isEditMode ? 'Modifier la Review' : 'Soumettre une Review' }}</h2>
      <p class="text-gray-600 text-sm">√âvaluez l'article de mani√®re objective et constructive</p>
    </div>

    <!-- Informations sur l'article -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6" *ngIf="assignment">
      <h3 class="text-xl font-bold text-gray-900 mb-4">üìÑ Article √† √©valuer</h3>
      <div class="space-y-3">
        <div>
          <p class="text-sm text-gray-600 font-medium">Titre</p>
          <p class="text-gray-900 font-bold">{{ assignment.article_titre }}</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-600 font-medium">Auteur</p>
            <p class="text-gray-900">{{ assignment.auteur_nom }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600 font-medium">Date de soumission</p>
            <p class="text-gray-900">{{ assignment.article_date_soumission | date:'dd/MM/yyyy' }}</p>
          </div>
          <div *ngIf="assignment.date_limite">
            <p class="text-sm text-gray-600 font-medium">Date limite</p>
            <p class="text-gray-900">{{ assignment.date_limite | date:'dd/MM/yyyy' }}</p>
          </div>
        </div>
        <div *ngIf="assignment.article_resume">
          <p class="text-sm text-gray-600 font-medium">R√©sum√©</p>
          <p class="text-gray-900">{{ assignment.article_resume }}</p>
        </div>
        <div *ngIf="assignment.article_mots_cles">
          <p class="text-sm text-gray-600 font-medium">Mots-cl√©s</p>
          <p class="text-gray-900">{{ assignment.article_mots_cles }}</p>
        </div>
        <div *ngIf="assignment.article_fichier_pdf">
          <a [href]="getPdfUrl(assignment.article_fichier_pdf)" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
            üìé T√©l√©charger le PDF
          </a>
        </div>
      </div>
    </div>

    <!-- Formulaire de review -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6" *ngIf="assignment">
      <h3 class="text-xl font-bold text-gray-900 mb-6">‚úçÔ∏è Votre √©valuation</h3>

      <!-- Scores d'√©valuation -->
      <div class="space-y-6 mb-6">
        <!-- Score Qualit√© -->
        <div class="border border-gray-200 rounded-lg p-4">
          <h4 class="font-bold text-gray-900 mb-2">1. Qualit√© scientifique *</h4>
          <p class="text-sm text-gray-600 mb-4">√âvaluez la rigueur m√©thodologique, la solidit√© des r√©sultats et la pertinence scientifique.</p>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
            <button class="p-3 border-2 rounded-lg font-bold transition-all" 
                 *ngFor="let criteria of criteriaQualite"
                 [class]="form.score_qualite === criteria.value 
                   ? 'border-blue-500 bg-blue-50 text-blue-700' 
                   : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'"
                 (click)="form.score_qualite = criteria.value">
              <div class="text-2xl">{{ criteria.value }}</div>
              <div class="text-xs">{{ criteria.label }}</div>
            </button>
          </div>
        </div>

        <!-- Score Originalit√© -->
        <div class="border border-gray-200 rounded-lg p-4">
          <h4 class="font-bold text-gray-900 mb-2">2. Originalit√© et innovation *</h4>
          <p class="text-sm text-gray-600 mb-4">√âvaluez le caract√®re novateur de l'approche et la contribution √† la recherche.</p>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
            <button class="p-3 border-2 rounded-lg font-bold transition-all" 
                 *ngFor="let criteria of criteriaOriginalite"
                 [class]="form.score_originalite === criteria.value 
                   ? 'border-green-500 bg-green-50 text-green-700' 
                   : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'"
                 (click)="form.score_originalite = criteria.value">
              <div class="text-2xl">{{ criteria.value }}</div>
              <div class="text-xs">{{ criteria.label }}</div>
            </button>
          </div>
        </div>

        <!-- Score Clart√© -->
        <div class="border border-gray-200 rounded-lg p-4">
          <h4 class="font-bold text-gray-900 mb-2">3. Clart√© et structure *</h4>
          <p class="text-sm text-gray-600 mb-4">√âvaluez la qualit√© de la r√©daction, la structure et la facilit√© de compr√©hension.</p>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
            <button class="p-3 border-2 rounded-lg font-bold transition-all" 
                 *ngFor="let criteria of criteriaClarte"
                 [class]="form.score_clarte === criteria.value 
                   ? 'border-purple-500 bg-purple-50 text-purple-700' 
                   : 'border-gray-300 bg-white text-gray-700 hover:border-gray-400'"
                 (click)="form.score_clarte = criteria.value">
              <div class="text-2xl">{{ criteria.value }}</div>
              <div class="text-xs">{{ criteria.label }}</div>
            </button>
          </div>
        </div>
      </div>

      <!-- Score moyen -->
      <div class="bg-gradient-to-r from-gray-100 to-gray-50 rounded-lg p-4 mb-6" *ngIf="getAverageScore() > 0">
        <h4 class="font-bold text-gray-900 mb-2">Score moyen</h4>
        <div class="text-3xl font-bold text-white rounded-lg p-4 text-center" [style.background-color]="getScoreColor(getAverageScore())">
          {{ getAverageScore().toFixed(2) }} / 5
        </div>
      </div>

      <!-- Commentaires -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Commentaires d√©taill√©s *</label>
        <p class="text-sm text-gray-600 mb-2">Fournissez une √©valuation d√©taill√©e : points forts, points faibles, suggestions d'am√©lioration.</p>
        <textarea 
          [(ngModel)]="form.commentaires" 
          name="commentaires" 
          rows="10" 
          required
          placeholder="Votre √©valuation d√©taill√©e de l'article..."
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
        <p class="text-sm text-gray-500 mt-1">{{ form.commentaires.length }} caract√®res</p>
      </div>

      <!-- Recommandation -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-3">Recommandation finale *</label>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <button type="button" class="border-2 rounded-lg p-4 transition-all" 
               [class]="form.recommandation === 'accepter' 
                 ? 'border-green-500 bg-green-50' 
                 : 'border-gray-300 bg-white hover:border-green-300'"
               (click)="form.recommandation = 'accepter'">
            <div class="text-2xl mb-2">‚úì</div>
            <strong class="block text-gray-900">Accepter</strong>
            <small class="text-gray-600">Article pr√™t pour publication</small>
          </button>
          <button type="button" class="border-2 rounded-lg p-4 transition-all" 
               [class]="form.recommandation === 'reviser' 
                 ? 'border-orange-500 bg-orange-50' 
                 : 'border-gray-300 bg-white hover:border-orange-300'"
               (click)="form.recommandation = 'reviser'">
            <div class="text-2xl mb-2">‚úé</div>
            <strong class="block text-gray-900">R√©viser</strong>
            <small class="text-gray-600">Modifications n√©cessaires</small>
          </button>
          <button type="button" class="border-2 rounded-lg p-4 transition-all" 
               [class]="form.recommandation === 'rejeter' 
                 ? 'border-red-500 bg-red-50' 
                 : 'border-gray-300 bg-white hover:border-red-300'"
               (click)="form.recommandation = 'rejeter'">
            <div class="text-2xl mb-2">‚úó</div>
            <strong class="block text-gray-900">Rejeter</strong>
            <small class="text-gray-600">Article non acceptable</small>
          </button>
        </div>
      </div>

      <!-- R√©sum√© de la review -->
      <div class="bg-gray-50 rounded-lg p-4 mb-6" *ngIf="form.recommandation">
        <h4 class="font-bold text-gray-900 mb-4">üìã R√©sum√© de votre √©valuation</h4>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
          <div class="bg-white rounded-lg p-3 text-center border border-blue-200">
            <p class="text-xl font-bold text-blue-600">{{ form.score_qualite }}</p>
            <p class="text-xs text-gray-600">Qualit√©</p>
          </div>
          <div class="bg-white rounded-lg p-3 text-center border border-green-200">
            <p class="text-xl font-bold text-green-600">{{ form.score_originalite }}</p>
            <p class="text-xs text-gray-600">Originalit√©</p>
          </div>
          <div class="bg-white rounded-lg p-3 text-center border border-purple-200">
            <p class="text-xl font-bold text-purple-600">{{ form.score_clarte }}</p>
            <p class="text-xs text-gray-600">Clart√©</p>
          </div>
          <div class="bg-white rounded-lg p-3 text-center border-2" [style.border-color]="getScoreColor(getAverageScore())">
            <p class="text-xl font-bold" [style.color]="getScoreColor(getAverageScore())">{{ getAverageScore().toFixed(2) }}</p>
            <p class="text-xs text-gray-600">Moyenne</p>
          </div>
          <div class="rounded-lg p-3 text-center" [style.background-color]="getRecommendationColor(form.recommandation) + '20'">
            <p class="font-bold text-white text-xs px-2 py-1 rounded" [style.background-color]="getRecommendationColor(form.recommandation)">
              {{ getRecommendationLabel(form.recommandation) }}
            </p>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <button class="px-4 py-2 rounded-lg font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" (click)="cancel()">
          Annuler
        </button>
        <button class="px-4 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed" 
                (click)="submitReview()"
                [disabled]="!form.commentaires || !form.recommandation || form.score_qualite === 0 || form.score_originalite === 0 || form.score_clarte === 0">
          {{ isEditMode ? 'üíæ Mettre √† jour' : 'üì§ Soumettre la review' }}
        </button>
      </div>
    </div>
  
    <!-- Message si pas d'assignation -->
    <div class="text-center py-14 bg-white rounded-lg shadow-md" *ngIf="!assignment">
      <div class="text-4xl mb-3">‚ö†Ô∏è</div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Aucune assignation</h3>
      <p class="text-gray-600 mb-5 text-sm">Aucune assignation s√©lectionn√©e. Veuillez retourner √† la page des assignations pour en choisir une.</p>
      <button class="px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white font-medium rounded-lg transition-colors" (click)="cancel()">‚Ü©Ô∏è Retour aux assignations</button>
    </div>
  </div>
</div>
