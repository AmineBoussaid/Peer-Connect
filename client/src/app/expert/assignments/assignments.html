<div class="min-h-screen bg-gray-50 py-8 px-4">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-7">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Mes Assignations</h2>
      <p class="text-gray-600 text-sm">GÃ©rez vos assignations et Ã©valuations d'articles</p>
    </div>

    <!-- Statistiques -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-blue-500">
        <p class="text-2xl font-bold text-gray-900">{{ getTotalAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">Total assignations</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-yellow-500">
        <p class="text-2xl font-bold text-gray-900">{{ getPendingAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">En attente</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-cyan-500">
        <p class="text-2xl font-bold text-gray-900">{{ getInProgressAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">En cours</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-green-500">
        <p class="text-2xl font-bold text-gray-900">{{ getCompletedAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">ComplÃ©tÃ©es</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-red-500">
        <p class="text-2xl font-bold text-gray-900">{{ getUrgentAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">Urgentes</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-4 border-l-4 border-orange-500">
        <p class="text-2xl font-bold text-gray-900">{{ getOverdueAssignments() }}</p>
        <p class="text-xs text-gray-600 mt-1">En retard</p>
      </div>
    </div>

    <!-- Filtres et contrÃ´les -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <input type="text" 
               [(ngModel)]="searchTerm" 
               (ngModelChange)="applyFilters()"
               placeholder="ğŸ” Rechercher..."
               class="md:col-span-2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <select [(ngModel)]="filterStatut" (ngModelChange)="applyFilters()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option value="all">Tous les statuts</option>
          <option value="en_attente">En attente</option>
          <option value="en_cours">En cours</option>
          <option value="termine">TerminÃ©e</option>
          <option value="annulee">AnnulÃ©e</option>
          <option value="refuse">RefusÃ©e</option>
          <option value="urgentes">Urgente</option>
          <option value="en_retard">En retard</option>
        </select>
        <select [(ngModel)]="filterUrgence" (ngModelChange)="applyFilters()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option value="all">Toutes les urgences</option>
          <option value="urgent">Urgentes (â‰¤ 3 jours)</option>
          <option value="overdue">En retard</option>
        </select>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <select [(ngModel)]="sortBy" (ngModelChange)="applyFilters()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <option value="date">Trier par date</option>
          <option value="deadline">Trier par Ã©chÃ©ance</option>
          <option value="title">Trier par titre</option>
        </select>
        <div class="flex gap-2">
          <button (click)="viewMode = 'cards'" [class]="viewMode === 'cards' ? 'flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium' : 'flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200'" title="Vue cartes">âŠ Cartes</button>
          <button (click)="viewMode = 'table'" [class]="viewMode === 'table' ? 'flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium' : 'flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200'" title="Vue tableau">â˜° Tableau</button>
        </div>
      </div>
    </div>

    <!-- Liste des assignations (Vue cartes) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" *ngIf="viewMode === 'cards' && filteredAssignments.length > 0">
      <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow overflow-hidden border-l-4" 
           *ngFor="let assign of filteredAssignments"
           [style.border-left-color]="getStatutColor(assign.statut_assignation)">
        <div class="p-4 border-b border-gray-200">
          <div class="flex items-start justify-between">
            <h3 class="font-bold text-gray-900">{{ assign.article_titre }}</h3>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium text-white" [style.background-color]="getStatutColor(assign.statut_assignation)">
              {{ getStatutLabel(assign.statut_assignation) }}
            </span>
            <span *ngIf="assign.recommendation" class="ml-2 inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-indigo-100 text-indigo-800">
              {{ assign.recommendation }}
            </span>
          </div>
        </div>
        
        <div class="p-4 space-y-3">
          <div class="flex items-center text-sm text-gray-600">
            <span class="font-medium mr-2">ğŸ‘¤</span>
            <span>{{ assign.auteur_nom }}</span>
          </div>
          <div class="flex items-center text-sm text-gray-600">
            <span class="font-medium mr-2">ğŸ“§</span>
            <span class="truncate">{{ assign.auteur_email }}</span>
          </div>
          <div class="flex items-center text-sm text-gray-600">
            <span class="font-medium mr-2">ğŸ“…</span>
            <span>{{ getSubmissionDate(assign) ? (getSubmissionDate(assign) | date:'dd/MM/yyyy') : '-' }}</span>
          </div>
          <div class="flex items-center text-sm" *ngIf="assign.date_limite" 
               [class]="getDaysLeft(assign.date_limite) < 0 ? 'text-red-600' : getDaysLeft(assign.date_limite) <= 3 ? 'text-orange-600' : 'text-gray-600'">
            <span class="font-medium mr-2">â°</span>
            <span>
              {{ assign.date_limite | date:'dd/MM/yyyy' }}
              <strong *ngIf="getDaysLeft(assign.date_limite) >= 0 && assign.statut_assignation !== 'termine'">
                ({{ getDaysLeft(assign.date_limite) }} j.)
              </strong>
              <strong *ngIf="getDaysLeft(assign.date_limite) < 0 && assign.statut_assignation !== 'termine'">
                (-{{ Math.abs(getDaysLeft(assign.date_limite)) }} j.)
              </strong>
            </span>
          </div>
          <div class="flex items-start text-sm text-gray-600" *ngIf="assign.article_mots_cles">
            <span class="font-medium mr-2">ğŸ·ï¸</span>
            <span class="line-clamp-2">{{ assign.article_mots_cles }}</span>
          </div>
          <div class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800" *ngIf="assign.has_review > 0">
            âœ“ Review soumise
          </div>
        </div>

        <div class="p-4 border-t border-gray-200 flex flex-wrap gap-2">
          <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-gray-600 hover:bg-gray-700 text-sm transition-colors" (click)="viewArticleDetails(assign)">ğŸ“„ DÃ©tails</button>
           <a class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 text-sm transition-colors text-center inline-block" *ngIf="assign.article_fichier_pdf" 
             [href]="getPdfUrl(assign.article_fichier_pdf)" target="_blank" rel="noopener noreferrer">
            ğŸ“ PDF
           </a>
            <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-green-600 hover:bg-green-700 text-sm transition-colors" 
              *ngIf="assign.statut_assignation === 'en_attente'"
              (click)="updateStatut(assign, 'en_cours')">
            â–¶ï¸ Commencer
          </button>
          <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-red-600 hover:bg-red-700 text-sm transition-colors" 
                  *ngIf="assign.statut_assignation === 'en_attente'"
                  (click)="updateStatut(assign, 'refuse')">
            âœ– Refuser
          </button>
          <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-orange-600 hover:bg-orange-700 text-sm transition-colors" 
            *ngIf="assign.statut_assignation === 'en_cours'"
            (click)="updateStatut(assign, 'annulee')">
            â†© Annuler
          </button>
          <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-purple-600 hover:bg-purple-700 text-sm transition-colors" 
            *ngIf="assign.statut_assignation !== 'termine' && assign.has_review === 0 && assign.statut_assignation !== 'en_attente' && assign.statut_assignation !== 'refuse'"
                  (click)="goToReview(assign)">
            âœï¸ Review
          </button>
            <button class="flex-1 px-3 py-2 rounded-lg font-medium text-white bg-cyan-600 hover:bg-cyan-700 text-sm transition-colors" 
              *ngIf="assign.has_review > 0 && assign.statut_assignation !== 'en_attente' && assign.statut_assignation !== 'refuse'"
                  (click)="goToReview(assign)">
            ğŸ‘ï¸ Voir Review
          </button>
        </div>
      </div>
    </div>
  
  <!-- Liste des assignations (Vue tableau) -->
  <div class="assignments-table-container" *ngIf="viewMode === 'table' && filteredAssignments.length > 0">
    <table class="assignments-table">
      <thead>
        <tr>
          <th>Titre</th>
          <th>Auteur</th>
          <th>Date assignation</th>
          <th>Date limite</th>
          <th>Statut</th>
          <th>Rec.</th>
          <th>Review</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let assign of filteredAssignments" [class]="getUrgencyClass(assign)">
          <td><strong>{{ assign.article_titre }}</strong></td>
          <td>{{ assign.auteur_nom }}</td>
          <td>{{ getSubmissionDate(assign) ? (getSubmissionDate(assign) | date:'dd/MM/yyyy') : '-' }}</td>
          <td>
            <span *ngIf="assign.date_limite">
              {{ assign.date_limite | date:'dd/MM/yyyy' }}
              <small *ngIf="getDaysLeft(assign.date_limite) >= 0 && assign.statut_assignation !== 'termine'">
                ({{ getDaysLeft(assign.date_limite) }}j)
              </small>
              <small *ngIf="getDaysLeft(assign.date_limite) < 0 && assign.statut_assignation !== 'termine'" class="overdue-text">
                ({{ Math.abs(getDaysLeft(assign.date_limite)) }}j retard)
              </small>
            </span>
            <span *ngIf="!assign.date_limite">-</span>
          </td>
          <td>
            <span class="status-badge-small" [ngStyle]="{'background-color': getStatutColor(assign.statut_assignation)}">
              {{ getStatutLabel(assign.statut_assignation) }}
            </span>
          </td>
          <td>{{ assign.recommendation || '-' }}</td>
          <td>{{ assign.has_review > 0 ? 'âœ“' : '-' }}</td>
          <td class="actions-cell">
            <button class="btn-small" (click)="viewArticleDetails(assign)" title="DÃ©tails">ğŸ“„</button>
            <button class="btn-small" (click)="goToReview(assign)" title="Review">âœï¸</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Message si aucune assignation -->
  <div class="no-assignments" *ngIf="filteredAssignments.length === 0 && assignments.length > 0">
    <p>Aucune assignation ne correspond aux critÃ¨res de recherche.</p>
  </div>
  
  <div class="no-assignments" *ngIf="assignments.length === 0">
    <p>Vous n'avez aucune assignation pour le moment.</p>
  </div>
  
  <!-- Modal DÃ©tails -->
  <div class="modal-overlay" *ngIf="selectedAssignment" (click)="closeDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“„ {{ selectedAssignment.article_titre }}</h3>
        <button class="close-btn" (click)="closeDetails()">âœ–</button>
      </div>
      <div class="modal-body">
        <div class="detail-section">
          <h4>Informations gÃ©nÃ©rales</h4>
          <p><strong>Statut:</strong> 
            <span class="status-badge" [ngStyle]="{'background-color': getStatutColor(selectedAssignment.statut_assignation)}">
              {{ getStatutLabel(selectedAssignment.statut_assignation) }}
            </span>
          </p>
          <p><strong>Auteur:</strong> {{ selectedAssignment.auteur_nom }} ({{ selectedAssignment.auteur_email }})</p>
          <p *ngIf="selectedAssignment.recommendation"><strong>Recommandation:</strong> {{ selectedAssignment.recommendation }}</p>
          <p><strong>Date de soumission:</strong> {{ getSubmissionDate(selectedAssignment) ? (getSubmissionDate(selectedAssignment) | date:'dd/MM/yyyy HH:mm') : '-' }}</p>
          <p *ngIf="selectedAssignment.date_limite"><strong>Date limite:</strong> {{ selectedAssignment.date_limite | date:'dd/MM/yyyy' }}</p>
        </div>
        
        <div class="detail-section">
          <h4>RÃ©sumÃ© de l'article</h4>
          <p>{{ selectedAssignment.article_resume || 'Aucun rÃ©sumÃ© disponible.' }}</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedAssignment.article_mots_cles">
          <h4>Mots-clÃ©s</h4>
          <p>{{ selectedAssignment.article_mots_cles }}</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedAssignment.article_fichier_pdf">
          <h4>Document PDF</h4>
          <a [href]="getPdfUrl(selectedAssignment.article_fichier_pdf)" target="_blank" class="pdf-download-btn">
            ğŸ“ TÃ©lÃ©charger le PDF
          </a>
        </div>
        
        <div class="modal-actions">
          <button class="btn-primary" *ngIf="selectedAssignment.has_review === 0" (click)="goToReview(selectedAssignment); closeDetails()">
            âœï¸ Soumettre une review
          </button>
          <button class="btn-secondary" (click)="closeDetails()">Fermer</button>
        </div>
      </div>
    </div>
  </div>
</div>
